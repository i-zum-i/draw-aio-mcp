# MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€MCP Draw.io ã‚µãƒ¼ãƒãƒ¼ã¨å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã®çµ±åˆãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ãªãã€å®Ÿéš›ã®MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦å®Ÿç’°å¢ƒã§ã®å‹•ä½œã‚’ä¿è¨¼ã—ã¾ã™ã€‚

## ç›®æ¬¡

- [ãƒ†ã‚¹ãƒˆã®ç›®çš„](#ãƒ†ã‚¹ãƒˆã®ç›®çš„)
- [ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ§‹æˆ](#ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ§‹æˆ)
- [å®Ÿè¡Œæ–¹æ³•](#å®Ÿè¡Œæ–¹æ³•)
- [ãƒ†ã‚¹ãƒˆå†…å®¹è©³ç´°](#ãƒ†ã‚¹ãƒˆå†…å®¹è©³ç´°)
- [çµæœã®è§£é‡ˆ](#çµæœã®è§£é‡ˆ)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³](#ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)

## ãƒ†ã‚¹ãƒˆã®ç›®çš„

### ä¸»è¦ç›®æ¨™

1. **å®Ÿç’°å¢ƒå‹•ä½œä¿è¨¼**: å®Ÿéš›ã®MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã®å‹•ä½œç¢ºèª
2. **ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹ ç¢ºèª**: MCPæ¨™æº–ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¸ã®å®Œå…¨æº–æ‹ 
3. **Claude Codeäº’æ›æ€§**: Claude Codeç’°å¢ƒã§ã®æ­£å¸¸å‹•ä½œ
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ¤œè¨¼**: ç•°å¸¸ç³»ã§ã®é©åˆ‡ãªå‹•ä½œ
5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª**: å®Ÿç”¨çš„ãªå¿œç­”æ™‚é–“ã®ç¢ºä¿

### å¯¾è±¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

- **å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª** (`mcp` Python SDK)
- **Claude Code** (Anthropicå…¬å¼IDEçµ±åˆ)
- **ãã®ä»–ã®MCPäº’æ›ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ** (æ¨™æº–ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹ )

## ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ§‹æˆ

### 1. å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `test_official_mcp_client_integration.py`

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- MCPã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†
- å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹
- ãƒ„ãƒ¼ãƒ«ãƒªã‚¹ãƒˆå–å¾—ã¨æ¤œè¨¼
- å„MCPãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª
- ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹ æ¤œè¨¼

**é‡è¦ãªæ©Ÿèƒ½**:
```python
class MCPClientIntegrationTester:
    async def test_tool_listing(self) -> bool
    async def test_generate_drawio_xml_tool(self) -> bool
    async def test_save_drawio_file_tool(self) -> bool
    async def test_convert_to_png_tool(self) -> bool
    async def test_error_handling(self) -> bool
    async def test_protocol_compliance(self) -> bool
```

### 2. Claude Codeçµ±åˆãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `test_claude_code_integration.py`

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- Claude Codeãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã¨æ¤œè¨¼
- ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ä½¿ç”¨ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ
- è‡ªå‹•æ‰¿èªè¨­å®šãƒ†ã‚¹ãƒˆ

**é‡è¦ãªæ©Ÿèƒ½**:
```python
class ClaudeCodeSimulator:
    async def test_mcp_config_validation(self) -> bool
    async def test_server_startup_simulation(self) -> bool
    async def test_workspace_integration(self) -> bool
    async def test_usage_scenarios(self) -> bool
    async def test_auto_approval_configuration(self) -> bool
```

### 3. çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œç®¡ç†

**ãƒ•ã‚¡ã‚¤ãƒ«**: `run_mcp_client_integration_tests.py`

**æ©Ÿèƒ½**:
- å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯
- å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å®Ÿè¡Œ
- çµæœé›†è¨ˆã¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- è©³ç´°ãƒ­ã‚°å‡ºåŠ›

## å®Ÿè¡Œæ–¹æ³•

### åŸºæœ¬å®Ÿè¡Œ

```bash
# å…¨çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
python run_mcp_client_integration_tests.py

# å€‹åˆ¥ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
python test_official_mcp_client_integration.py
python test_claude_code_integration.py
```

### å‰ææ¡ä»¶

1. **Python 3.10+**
2. **å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª**:
   ```bash
   pip install -r requirements.txt
   pip install -r requirements-dev.txt
   ```
3. **ç’°å¢ƒå¤‰æ•°** (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):
   ```bash
   export ANTHROPIC_API_KEY="your-api-key-here"
   ```

### Dockerç’°å¢ƒã§ã®å®Ÿè¡Œ

```bash
# Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker run --rm -it \
  -v $(pwd):/app \
  -w /app \
  -e ANTHROPIC_API_KEY="your-api-key" \
  python:3.10 \
  python run_mcp_client_integration_tests.py
```

## ãƒ†ã‚¹ãƒˆå†…å®¹è©³ç´°

### å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ

#### 1. ãƒ„ãƒ¼ãƒ«ãƒªã‚¹ãƒˆå–å¾—ãƒ†ã‚¹ãƒˆ

```python
async def test_tool_listing(self) -> bool:
    """æœŸå¾…ã•ã‚Œã‚‹MCPãƒ„ãƒ¼ãƒ«ãŒæ­£ã—ãå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆ"""
    tools_result = await self.client_session.list_tools(ListToolsRequest())
    expected_tools = {"generate-drawio-xml", "save-drawio-file", "convert-to-png"}
    actual_tools = {tool.name for tool in tools_result.tools}
    return expected_tools.issubset(actual_tools)
```

**æ¤œè¨¼é …ç›®**:
- 3ã¤ã®å¿…é ˆãƒ„ãƒ¼ãƒ«ã®å­˜åœ¨ç¢ºèª
- ãƒ„ãƒ¼ãƒ«ã‚¹ã‚­ãƒ¼ãƒã®å¦¥å½“æ€§
- ãƒ„ãƒ¼ãƒ«èª¬æ˜ã®é©åˆ‡æ€§

#### 2. generate-drawio-xml ãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ

```python
async def test_generate_drawio_xml_tool(self) -> bool:
    """XMLç”Ÿæˆãƒ„ãƒ¼ãƒ«ã®å‹•ä½œãƒ†ã‚¹ãƒˆ"""
    result = await self.client_session.call_tool(
        CallToolRequest(
            name="generate-drawio-xml",
            arguments={"prompt": "Create a simple flowchart with Start -> Process -> End"}
        )
    )
    # XMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ¤œè¨¼
    return self.validate_xml_response(result)
```

**æ¤œè¨¼é …ç›®**:
- æœ‰åŠ¹ãªDraw.io XMLã®ç”Ÿæˆ
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡¦ç†ã®æ­£ç¢ºæ€§
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®æº–æ‹ 

#### 3. save-drawio-file ãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ

```python
async def test_save_drawio_file_tool(self) -> bool:
    """ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ„ãƒ¼ãƒ«ã®å‹•ä½œãƒ†ã‚¹ãƒˆ"""
    result = await self.client_session.call_tool(
        CallToolRequest(
            name="save-drawio-file",
            arguments={
                "xml_content": test_xml,
                "filename": "integration-test-diagram"
            }
        )
    )
    return self.validate_file_save_response(result)
```

**æ¤œè¨¼é …ç›®**:
- ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã®æˆåŠŸ
- ãƒ•ã‚¡ã‚¤ãƒ«IDã®ç”Ÿæˆ
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§

#### 4. convert-to-png ãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ

```python
async def test_convert_to_png_tool(self) -> bool:
    """PNGå¤‰æ›ãƒ„ãƒ¼ãƒ«ã®å‹•ä½œãƒ†ã‚¹ãƒˆ"""
    # ã¾ãšãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
    file_id = await self.save_test_file()
    
    # PNGå¤‰æ›ã‚’å®Ÿè¡Œ
    result = await self.client_session.call_tool(
        CallToolRequest(
            name="convert-to-png",
            arguments={"file_id": file_id}
        )
    )
    return self.validate_png_conversion_response(result)
```

**æ¤œè¨¼é …ç›®**:
- PNGå¤‰æ›ã®å®Ÿè¡Œ
- Draw.io CLIåˆ©ç”¨å¯èƒ½æ€§ã®ç¢ºèª
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã®å‹•ä½œ

### Claude Codeçµ±åˆãƒ†ã‚¹ãƒˆ

#### 1. MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼

```python
async def test_mcp_config_validation(self) -> bool:
    """Claude Codeç”¨MCPè¨­å®šã®å¦¥å½“æ€§ãƒ†ã‚¹ãƒˆ"""
    config = self.load_mcp_config()
    
    # å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç¢ºèª
    required_fields = ["command", "args", "cwd"]
    for field in required_fields:
        if field not in config["mcpServers"]["drawio-server"]:
            return False
    
    # ãƒ‘ã‚¹ã®å­˜åœ¨ç¢ºèª
    return self.validate_paths(config)
```

**æ¤œè¨¼é …ç›®**:
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã®æ­£ç¢ºæ€§
- å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å­˜åœ¨
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æœ‰åŠ¹æ€§
- è‡ªå‹•æ‰¿èªè¨­å®šã®é©åˆ‡æ€§

#### 2. ä½¿ç”¨ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

```python
async def test_usage_scenarios(self) -> bool:
    """å…¸å‹çš„ãªClaude Codeä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ†ã‚¹ãƒˆ"""
    scenarios = [
        {
            "name": "ç°¡å˜ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä½œæˆ",
            "prompt": "Create a simple flowchart for user registration process",
            "expected_tools": ["generate-drawio-xml"]
        },
        {
            "name": "å›³è¡¨ä¿å­˜ã¨PNGå¤‰æ›",
            "prompt": "Save the diagram and convert to PNG for documentation",
            "expected_tools": ["save-drawio-file", "convert-to-png"]
        }
    ]
    
    return self.validate_scenarios(scenarios)
```

**æ¤œè¨¼é …ç›®**:
- å®Ÿç”¨çš„ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¦¥å½“æ€§
- ãƒ„ãƒ¼ãƒ«é¸æŠã®é©åˆ‡æ€§
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é€£æºã®ç¢ºèª

## çµæœã®è§£é‡ˆ

### æˆåŠŸåŸºæº–

#### å…¨ä½“æˆåŠŸã®æ¡ä»¶
- ã™ã¹ã¦ã®ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ
- æˆåŠŸç‡ãŒ95%ä»¥ä¸Š
- ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹ ãƒ†ã‚¹ãƒˆãŒå®Œå…¨æˆåŠŸ

#### å€‹åˆ¥ãƒ†ã‚¹ãƒˆæˆåŠŸåŸºæº–

**å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçµ±åˆ**:
- ãƒ„ãƒ¼ãƒ«ãƒªã‚¹ãƒˆå–å¾—: 3ã¤ã®ãƒ„ãƒ¼ãƒ«ã™ã¹ã¦ãŒæ­£ã—ãå…¬é–‹
- XMLç”Ÿæˆ: æœ‰åŠ¹ãªDraw.io XMLãŒç”Ÿæˆã•ã‚Œã‚‹
- ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜: ãƒ•ã‚¡ã‚¤ãƒ«IDãŒæ­£å¸¸ã«è¿”ã•ã‚Œã‚‹
- PNGå¤‰æ›: å¤‰æ›å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆCLIåˆ©ç”¨å¯å¦ã«é–¢ã‚ã‚‰ãšï¼‰

**Claude Codeçµ±åˆ**:
- MCPè¨­å®š: æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãªã—ã€å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®Œå‚™
- ã‚µãƒ¼ãƒãƒ¼èµ·å‹•: ãƒ—ãƒ­ã‚»ã‚¹ãŒæ­£å¸¸ã«é–‹å§‹
- ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹çµ±åˆ: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ã„å ´æ‰€ã«é…ç½®

### çµæœãƒ¬ãƒãƒ¼ãƒˆ

#### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ä¾‹

```
ğŸ“Š MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼
================================================================================
ğŸ¯ ç·åˆè©•ä¾¡: âœ… æˆåŠŸ

ğŸ“ˆ ãƒ†ã‚¹ãƒˆçµ±è¨ˆ:
   ç·ãƒ†ã‚¹ãƒˆæ•°: 11
   æˆåŠŸ: 11
   å¤±æ•—: 0
   æˆåŠŸç‡: 100.0%

ğŸ”¥ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ:
   ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ†ã‚¹ãƒˆæ•°: 6
   æˆåŠŸ: 6
   å¤±æ•—: 0
   æˆåŠŸç‡: 100.0%

â±ï¸ å®Ÿè¡Œæ™‚é–“:
   ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“: 45.32ç§’
   å…¨ä½“å®Ÿè¡Œæ™‚é–“: 48.15ç§’

ğŸ“‹ å€‹åˆ¥ãƒ†ã‚¹ãƒˆçµæœ:
   âœ… å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ - ãƒ„ãƒ¼ãƒ«ãƒªã‚¹ãƒˆå–å¾— ğŸ”¥ (2.15ç§’)
   âœ… å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ - generate-drawio-xml ãƒ„ãƒ¼ãƒ« ğŸ”¥ (8.42ç§’)
   âœ… å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ - save-drawio-file ãƒ„ãƒ¼ãƒ« ğŸ”¥ (1.23ç§’)
   âœ… å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ - convert-to-png ãƒ„ãƒ¼ãƒ« ğŸ”¥ (12.34ç§’)
   âœ… å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° (1.45ç§’)
   âœ… å…¬å¼MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ - ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹  ğŸ”¥ (0.89ç§’)
   âœ… Claude Code - MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ ğŸ”¥ (0.12ç§’)
   âœ… Claude Code - ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (3.45ç§’)
   âœ… Claude Code - ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹çµ±åˆ (0.34ç§’)
   âœ… Claude Code - ä½¿ç”¨ã‚·ãƒŠãƒªã‚ª (0.23ç§’)
   âœ… Claude Code - è‡ªå‹•æ‰¿èªè¨­å®š (0.15ç§’)
```

#### JSONè©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ

```json
{
  "test_run_info": {
    "timestamp": "2024-01-15 14:30:25",
    "python_version": "3.10.12",
    "working_directory": "/path/to/mcp-server",
    "environment": {
      "ANTHROPIC_API_KEY": "è¨­å®šæ¸ˆã¿"
    }
  },
  "summary": {
    "overall_success": true,
    "total_tests": 11,
    "successful_tests": 11,
    "failed_tests": 0,
    "success_rate": 100.0,
    "critical_tests": 6,
    "critical_passed": 6,
    "critical_failed": 0,
    "critical_success_rate": 100.0,
    "total_execution_time": 45.32,
    "overall_execution_time": 48.15,
    "test_results": [...]
  }
}
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. MCPãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ç—‡çŠ¶**:
```
âŒ Failed to import MCP library: No module named 'mcp'
```

**è§£æ±ºæ–¹æ³•**:
```bash
pip install mcp[cli]>=1.2.0
```

#### 2. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¤±æ•—

**ç—‡çŠ¶**:
```
âŒ ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ‚äº†ã—ã¾ã—ãŸ: ModuleNotFoundError: No module named 'src'
```

**è§£æ±ºæ–¹æ³•**:
```bash
# PYTHONPATHã®è¨­å®š
export PYTHONPATH="${PYTHONPATH}:$(pwd)/src"

# ã¾ãŸã¯ç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ä¿®æ­£
cd mcp-server
python -m src.server
```

#### 3. APIã‚­ãƒ¼é–¢é€£ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**:
```
âŒ APIã‚­ãƒ¼æ¤œè¨¼ã«å¤±æ•—: Invalid API key format
```

**è§£æ±ºæ–¹æ³•**:
```bash
# æœ‰åŠ¹ãªAPIã‚­ãƒ¼ã®è¨­å®š
export ANTHROPIC_API_KEY="sk-ant-your-actual-api-key"

# ã¾ãŸã¯é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆ
export DEVELOPMENT_MODE="true"
```

#### 4. Draw.io CLI ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**:
```
âš ï¸ Draw.io CLI ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“
```

**è§£æ±ºæ–¹æ³•**:
```bash
# Node.jsç’°å¢ƒã§ã®CLIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g @drawio/drawio-desktop-cli

# ã¾ãŸã¯Dockerã‚³ãƒ³ãƒ†ãƒŠã®ä½¿ç”¨
docker run --rm -v $(pwd):/app mcp-drawio-server:latest
```

#### 5. æ¨©é™ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**:
```
âŒ Permission denied: '/tmp/mcp_test_xxx'
```

**è§£æ±ºæ–¹æ³•**:
```bash
# ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™ä¿®æ­£
chmod 755 /tmp
mkdir -p ./temp
export TEMP_DIR="./temp"
```

### ãƒ‡ãƒãƒƒã‚°æ‰‹é †

#### 1. è©³ç´°ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–

```bash
export LOG_LEVEL="DEBUG"
python run_mcp_client_integration_tests.py
```

#### 2. å€‹åˆ¥ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
python test_official_mcp_client_integration.py

# ã¾ãŸã¯ç‰¹å®šã®æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
python -c "
import asyncio
from test_official_mcp_client_integration import MCPClientIntegrationTester
async def main():
    tester = MCPClientIntegrationTester()
    await tester.setup()
    result = await tester.test_tool_listing()
    print(f'Result: {result}')
    await tester.teardown()
asyncio.run(main())
"
```

#### 3. ã‚µãƒ¼ãƒãƒ¼ã®æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

```bash
# ã‚µãƒ¼ãƒãƒ¼ã‚’æ‰‹å‹•ã§èµ·å‹•
python -m src.server

# åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
python -c "
import asyncio
from mcp.client.stdio import stdio_client
from mcp.client import ClientSession
# ... ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
"
```

## ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### GitHub Actionsè¨­å®šä¾‹

```yaml
name: MCP Client Integration Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  integration-tests:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: [3.10, 3.11, 3.12]
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install -r requirements-dev.txt
    
    - name: Install Draw.io CLI
      run: |
        npm install -g @drawio/drawio-desktop-cli
    
    - name: Run MCP Client Integration Tests
      env:
        ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      run: |
        cd mcp-server
        python run_mcp_client_integration_tests.py
    
    - name: Upload test results
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: integration-test-results-${{ matrix.python-version }}
        path: mcp-server/mcp_integration_test_report.json
```

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã®ç¶™ç¶šãƒ†ã‚¹ãƒˆ

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ç›£è¦–ã§ãƒ†ã‚¹ãƒˆè‡ªå‹•å®Ÿè¡Œ
pip install watchdog
python -c "
import time
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler
import subprocess

class TestHandler(FileSystemEventHandler):
    def on_modified(self, event):
        if event.src_path.endswith('.py'):
            print('Running integration tests...')
            subprocess.run(['python', 'run_mcp_client_integration_tests.py'])

observer = Observer()
observer.schedule(TestHandler(), path='src', recursive=True)
observer.start()
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    observer.stop()
observer.join()
"
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **å®šæœŸå®Ÿè¡Œ**: æ¯æ—¥ã¾ãŸã¯å„ã‚³ãƒŸãƒƒãƒˆæ™‚ã«å®Ÿè¡Œ
2. **ç’°å¢ƒåˆ†é›¢**: æœ¬ç•ªç’°å¢ƒã¨ã¯åˆ†é›¢ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’ä½¿ç”¨
3. **çµæœä¿å­˜**: ãƒ†ã‚¹ãƒˆçµæœã‚’å±¥æ­´ã¨ã—ã¦ä¿å­˜
4. **å¤±æ•—æ™‚å¯¾å¿œ**: å¤±æ•—æ™‚ã®è‡ªå‹•é€šçŸ¥ã¨ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

### ãƒ†ã‚¹ãƒˆä¿å®ˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ãƒ†ã‚¹ãƒˆæ›´æ–°**: MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«æ›´æ–°æ™‚ã®ãƒ†ã‚¹ãƒˆåŒæœŸ
2. **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›£è¦–**: æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºä¿
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**: å®Ÿè¡Œæ™‚é–“ã®ç¶™ç¶šçš„ãªç›£è¦–
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: ãƒ†ã‚¹ãƒˆæ‰‹é †ã®æœ€æ–°åŒ–

## ã¾ã¨ã‚

MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆã¯ã€å®Ÿç’°å¢ƒã§ã®å‹•ä½œä¿è¨¼ã‚’æä¾›ã™ã‚‹é‡è¦ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã§ã™ã€‚å®šæœŸçš„ãªå®Ÿè¡Œã«ã‚ˆã‚Šã€MCPã‚µãƒ¼ãƒãƒ¼ã®å“è³ªã¨ä¿¡é ¼æ€§ã‚’ç¶­æŒã§ãã¾ã™ã€‚

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

- **å®Ÿéš›ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½¿ç”¨**: ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆã§ã¯ãªãå…¬å¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨
- **åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ**: ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹ ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¾ã§ç¶²ç¾…
- **ç¶™ç¶šçš„å®Ÿè¡Œ**: é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ã«çµ„ã¿è¾¼ã‚“ã å®šæœŸå®Ÿè¡Œ
- **è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ**: å•é¡Œç‰¹å®šã®ãŸã‚ã®è©³ç´°ãªçµæœè¨˜éŒ²

ã“ã‚Œã‚‰ã®ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚Šã€MCPã‚µãƒ¼ãƒãƒ¼ãŒå®Ÿéš›ã®Claude Codeç’°å¢ƒã‚„ä»–ã®MCPäº’æ›ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã§ãã¾ã™ã€‚